# 智能写作工坊模块功能定义

## 1. 模块概述

智能写作工坊模块是AI小说创作工具“创世之笔”的核心功能之一，为用户提供沉浸式的写作环境和智能写作辅助工具。该模块旨在帮助用户专注于创作过程，通过AI辅助和结构化工具，提高写作效率和质量。

## 2. 核心功能

### 2.1 章节目录

- **层级展示**：
  - 以树状结构展示卷-章层级关系
  - 支持展开/折叠卷和章节
  - 显示章节标题、状态和字数

- **状态管理**：
  - 章节状态标注：未写/写作中/已完成
  - 章节类型标记：冲突/日常/转折等，使用不同颜色区分
  - 支持批量修改章节状态

- **快捷操作**：
  - 一键创建新章节
  - 一键删除章节
  - 一键移动章节位置
  - 一键复制章节内容

- **搜索和筛选**：
  - 支持按章节标题搜索
  - 支持按状态、类型筛选章节
  - 支持按字数范围筛选章节

### 2.2 沉浸式编辑器

- **编辑模式**：
  - **Markdown模式**：支持Markdown语法，实时预览
  - **富文本模式**：支持格式化工具栏，如字体、颜色、对齐等
  - **专注模式**：仅保留必要工具栏，减少干扰

- **编辑功能**：
  - 自动排版，保持文本整洁
  - 实时字数统计，显示当前字数和目标字数
  - 自动保存，防止内容丢失
  - 撤销/重做功能
  - 查找/替换功能

- **编辑器配置**：
  - 字体大小和类型调整
  - 行高和字间距调整
  - 主题切换（深色/浅色/护眼模式）
  - 布局调整（全屏/分屏）

- **高级功能**：
  - 章节内导航（通过标题快速跳转）
  - 注释和批注功能
  - 版本历史（查看编辑历史）

### 2.3 侧边信息栏

- **相关设定**：
  - 显示当前章节相关的角色设定
  - 显示当前章节相关的地点设定
  - 显示当前章节相关的物品设定
  - 点击可查看设定详情

- **章节信息**：
  - 本章节关键词（从章纲自动带入）
  - 章节目标字数和当前进度
  - 章节预计完成时间
  - 章节修改时间

- **写作辅助**：
  - 写作提示和建议
  - 常用写作模板
  - 章节大纲回顾

- **互动功能**：
  - 支持添加自定义笔记
  - 支持标记重点内容
  - 支持快速插入设定元素到编辑器

### 2.4 智能写作辅助

- **续写功能**：
  - 基于前文AI续写，保持风格一致
  - 支持控制续写风格（华丽/简洁/悬疑等）
  - 支持控制续写字数（短/中/长）
  - 支持多选续写结果

- **润色功能**：
  - 提升文笔，优化表达
  - 支持指定风格（华丽/简洁/悬疑等）
  - 支持批量润色和局部润色

- **扩写功能**：
  - 扩展简略描写，增加细节
  - 支持指定扩展方向（环境/动作/心理等）
  - 保持原文风格和逻辑

- **收束功能**：
  - 精简冗长段落，提炼核心内容
  - 保持原文意思不变
  - 支持批量收束和局部收束

- **对话优化**：
  - 使对话更符合角色性格
  - 基于角色设定优化对话内容
  - 支持批量优化和局部优化

- **描写生成**：
  - 基于场景关键词生成环境描写
  - 基于动作关键词生成动作描写
  - 基于心理关键词生成心理描写
  - 支持指定描写风格

### 2.5 AI写作模式

- **情节模式**：
  - 专注于推进情节发展
  - 提供情节转折建议
  - 强化冲突和矛盾
  - 保持情节连贯性

- **人物模式**：
  - 专注于人物塑造
  - 提供人物性格展现建议
  - 强化人物互动和情感表达
  - 保持人物一致性

- **情绪模式**：
  - 强化情绪渲染
  - 提供情绪表达建议
  - 调整语言风格以匹配情绪
  - 保持情绪连贯性

- **伏笔模式**：
  - 埋设和呼应伏笔
  - 提供伏笔设置建议
  - 确保伏笔的合理性和回收
  - 保持伏笔的隐蔽性和有效性

### 2.6 场景卡片

- **场景管理**：
  - 以卡片形式展示不同场景
  - 支持快速切换不同场景/视角
  - 支持场景排序和分类

- **场景内容**：
  - 场景标题和描述
  - 场景中的角色
  - 场景发生的地点
  - 场景的时间和天气

- **模板功能**：
  - 保存常用场景模板
  - 支持从模板创建新场景
  - 支持模板分享和导入

- **场景关联**：
  - 关联场景到相关章节
  - 关联场景到相关设定
  - 支持场景之间的跳转

## 3. 界面设计

### 3.1 整体布局

- **顶部导航栏**：
  - 模块标题：智能写作工坊
  - 操作按钮：保存、导出、设置
  - 编辑器模式切换：Markdown/富文本/专注模式

- **左侧边栏**：
  - 章节目录树状结构
  - 章节状态和类型筛选
  - 章节快捷操作按钮

- **主内容区**：
  - 沉浸式编辑器
  - 编辑器工具栏
  - 字数统计和进度显示

- **右侧边栏**：
  - 相关设定信息
  - 章节关键词和目标
  - 智能写作辅助工具
  - 场景卡片列表

### 3.2 核心组件

- **章节目录组件**：
  - Ant Design的Tree组件构建树状结构
  - 自定义节点样式，显示状态和类型
  - 拖拽功能支持章节排序

- **沉浸式编辑器组件**：
  - Monaco Editor作为核心编辑引擎
  - 自定义工具栏和状态栏
  - 实时预览功能

- **侧边信息栏组件**：
  - Ant Design的Card、List组件构建信息展示
  - 可折叠面板，节省空间
  - 实时更新的进度条

- **智能写作辅助组件**：
  - Ant Design的Button、Dropdown组件构建工具按钮
  - 模态框显示AI生成结果
  - 加载状态和错误处理

- **AI写作模式组件**：
  - Ant Design的Tabs组件切换不同模式
  - 模式特定的设置面板
  - 模式状态指示

- **场景卡片组件**：
  - Ant Design的Card组件构建场景卡片
  - 拖拽功能支持卡片排序
  - 卡片展开/折叠功能

## 4. 技术实现

### 4.1 前端实现

- **技术栈**：React + Ant Design + Monaco Editor + ECharts
- **核心组件**：
  - Monaco Editor实现沉浸式编辑器
  - Ant Design的Tree、Card、Button等组件构建界面
  - React-DnD实现拖拽功能
  - Axios处理API请求

- **交互逻辑**：
  - 实时保存编辑器内容
  - 动态更新侧边信息栏
  - 智能写作辅助的异步处理
  - 编辑器状态管理

### 4.2 后端实现

- **技术栈**：Python + Flask + SQLite + OpenAI API
- **核心功能**：
  - 章节数据的CRUD操作
  - 调用OpenAI API实现智能写作辅助
  - 处理编辑器内容的保存和加载
  - 生成写作统计数据

- **API设计**：
  - `GET /api/projects/<id>/chapters`：获取项目章节列表
  - `POST /api/projects/<id>/chapters`：创建新章节
  - `GET /api/chapters/<id>`：获取章节详情
  - `PUT /api/chapters/<id>`：更新章节内容
  - `DELETE /api/chapters/<id>`：删除章节
  - `POST /api/ai/continue_writing`：AI续写
  - `POST /api/ai/polish`：文本润色
  - `POST /api/ai/expand`：文本扩写
  - `POST /api/ai/condense`：文本收束
  - `POST /api/ai/optimize_dialogue`：对话优化
  - `POST /api/ai/generate_description`：生成描写

### 4.3 数据结构

- **章节表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 章节ID |
  | project_id | INTEGER | 项目ID |
  | volume_id | INTEGER | 卷ID |
  | title | VARCHAR(255) | 章节标题 |
  | content | TEXT | 章节内容 |
  | status | VARCHAR(50) | 状态(未写/写作中/已完成) |
  | type | VARCHAR(50) | 类型(冲突/日常/转折等) |
  | word_count | INTEGER | 字数 |
  | order_index | INTEGER | 排序索引 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **场景表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 场景ID |
  | project_id | INTEGER | 项目ID |
  | chapter_id | INTEGER | 章节ID |
  | title | VARCHAR(255) | 场景标题 |
  | description | TEXT | 场景描述 |
  | characters | TEXT | 场景中的角色（JSON格式） |
  | location_id | INTEGER | 场景地点ID |
  | time | VARCHAR(100) | 场景时间 |
  | weather | VARCHAR(100) | 场景天气 |
  | is_template | BOOLEAN | 是否为模板 |
  | order_index | INTEGER | 排序索引 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

## 5. 用户流程

### 5.1 进入写作工坊

1. 用户在项目编辑界面点击“智能写作工坊”按钮
2. 系统进入智能写作工坊模块
3. 显示章节目录和编辑器

### 5.2 选择章节

1. 用户在左侧章节目录中选择一个章节
2. 系统在编辑器中加载该章节的内容
3. 系统在右侧边栏显示该章节的相关信息

### 5.3 开始写作

1. 用户在编辑器中开始写作
2. 系统实时统计字数并显示进度
3. 系统自动保存内容
4. 用户可随时切换编辑模式

### 5.4 使用智能写作辅助

1. 用户在写作过程中遇到困难，点击智能写作辅助按钮
2. 用户选择需要的辅助功能（如续写、润色等）
3. 系统调用AI生成辅助内容
4. 用户查看生成的内容，选择是否采纳
5. 用户可对生成的内容进行修改

### 5.5 切换AI写作模式

1. 用户在顶部导航栏选择AI写作模式
2. 用户选择适合当前写作内容的模式（如情节模式、人物模式等）
3. 系统调整AI辅助的策略和建议

### 5.6 使用场景卡片

1. 用户在右侧边栏查看场景卡片
2. 用户点击场景卡片切换到对应场景
3. 用户可创建新的场景卡片或修改现有卡片
4. 用户可将场景卡片保存为模板

## 6. 功能价值

- **专注创作**：通过沉浸式编辑器和专注模式，帮助用户专注于创作
- **智能辅助**：利用AI提供写作辅助，降低创作难度
- **效率提升**：通过快捷操作和自动化功能，提高写作效率
- **质量保证**：通过智能写作辅助和一致性检查，提高写作质量
- **灵活性**：支持多种编辑模式和写作风格，适应不同用户需求

## 7. 未来扩展

- **语音输入**：支持语音转文字输入，提高输入效率
- **多语言支持**：支持多语言写作和翻译
- **协作编辑**：支持多用户协作编辑（未来版本）
- **AI内容评估**：使用AI评估写作内容的质量和改进空间
- **写作助手个性化**：根据用户的写作风格和偏好，个性化AI写作建议

智能写作工坊模块将成为用户进行具体创作的核心工具，通过AI辅助和人性化设计，帮助用户克服创作困难，提高写作效率和质量，享受创作过程。