# 作品导出模块功能定义

## 1. 模块概述

作品导出模块是AI小说创作工具“创世之笔”的核心功能之一，为用户提供作品的多格式导出和版本管理工具。该模块旨在帮助用户方便地导出作品为不同格式，管理作品的不同版本，确保作品的安全存储和便捷分享。

## 2. 核心功能

### 2.1 多格式导出

- **写作稿导出**：
  - **Word格式**：导出为.docx文件，支持格式化和样式保留
  - **PDF格式**：导出为.pdf文件，确保文档格式固定
  - **Markdown格式**：导出为.md文件，支持Markdown语法
  - **纯文本格式**：导出为.txt文件，仅保留文本内容

- **设定集导出**：
  - **结构化设定文档**：导出为包含所有设定元素的结构化文档
  - **设定关系图谱**：导出为包含关系图谱的可视化文档
  - **设定索引**：导出为包含设定元素索引的文档

- **投稿专用**：
  - **符合各平台格式要求**：支持导出为符合不同投稿平台要求的格式
  - **格式模板**：提供常见投稿平台的格式模板
  - **自动排版**：根据平台要求自动调整排版

- **导出设置**：
  - **内容选择**：支持选择导出的章节范围和内容
  - **格式选项**：支持设置字体、字号、行间距等格式选项
  - **目录生成**：支持自动生成目录和章节索引
  - **封面设置**：支持自定义封面和版权页

### 2.2 阶段性版本管理

- **版本创建**：
  - **支持创建不同版本节点**：为作品创建多个版本快照
  - **版本命名**：支持为版本设置名称和描述
  - **版本标签**：支持为版本添加标签，如“初稿”、“修订版”等

- **版本管理**：
  - **版本列表**：以列表形式展示所有版本
  - **版本详情**：查看版本的详细信息和创建时间
  - **版本筛选**：支持按标签、时间等筛选版本

- **版本对比**：
  - **版本对比功能**：比较不同版本之间的差异
  - **差异高亮**：高亮显示版本间的修改内容
  - **对比模式**：支持并排对比和融合对比

- **版本回滚**：
  - **一键回滚到历史版本**：将作品恢复到之前的版本状态
  - **回滚确认**：提供回滚前的确认和警告
  - **回滚历史**：记录版本回滚的历史记录

- **版本备份**：
  - **自动备份**：定期自动创建版本备份
  - **手动备份**：支持用户手动创建版本备份
  - **备份存储**：支持将版本备份存储到本地或云端

## 3. 界面设计

### 3.1 整体布局

- **顶部导航栏**：
  - 模块标题：作品导出
  - 操作按钮：导出、创建版本、设置
  - 视图切换：导出设置/版本管理

- **左侧边栏**：
  - 导出格式：写作稿/设定集/投稿专用
  - 版本列表：显示所有版本节点
  - 筛选条件：按版本标签、时间等筛选

- **主内容区**：
  - 导出设置表单（导出设置视图）
  - 版本详情和对比界面（版本管理视图）

- **右侧边栏**：
  - 导出预览：显示导出效果的预览
  - 版本信息：显示当前版本的详细信息
  - 操作历史：显示最近的导出和版本操作记录

### 3.2 核心组件

- **多格式导出组件**：
  - 导出格式选择器
  - 导出内容设置面板
  - 格式选项设置面板
  - 导出预览组件

- **版本管理组件**：
  - 版本列表或时间线
  - 版本创建表单
  - 版本对比界面
  - 版本回滚确认对话框

## 4. 技术实现

### 4.1 前端实现

- **技术栈**：React + Ant Design + FileSaver.js
- **核心组件**：
  - Ant Design的Form、Select、Button组件构建界面
  - FileSaver.js处理文件下载
  - Diff库实现版本对比功能
  - Axios处理API请求

- **交互逻辑**：
  - 实时更新导出预览
  - 动态生成导出设置表单
  - 版本对比的交互式操作
  - 导出进度的显示和处理

### 4.2 后端实现

- **技术栈**：Python + Flask + SQLite + Document Conversion Libraries
- **核心功能**：
  - 文档格式转换（Word/PDF/Markdown/Text）
  - 版本数据的存储和管理
  - 差异比较算法实现
  - 文件压缩和下载处理

- **API设计**：
  - `GET /api/export/project/<id>/word`：导出为Word格式
  - `GET /api/export/project/<id>/pdf`：导出为PDF格式
  - `GET /api/export/project/<id>/markdown`：导出为Markdown格式
  - `GET /api/export/project/<id>/text`：导出为纯文本格式
  - `POST /api/versions`：创建新版本
  - `GET /api/versions`：获取版本列表
  - `GET /api/versions/<id>`：获取版本详情
  - `POST /api/versions/<id>/rollback`：回滚到指定版本
  - `POST /api/versions/compare`：比较两个版本

### 4.3 数据结构

- **版本表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 版本ID |
  | project_id | INTEGER | 项目ID |
  | version_name | VARCHAR(255) | 版本名称 |
  | description | TEXT | 版本描述 |
  | tags | TEXT | 版本标签（JSON格式） |
  | content_hash | VARCHAR(255) | 内容哈希值 |
  | created_at | TIMESTAMP | 创建时间 |
  | created_by | VARCHAR(255) | 创建人 |

- **导出配置表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 配置ID |
  | project_id | INTEGER | 项目ID |
  | format_type | VARCHAR(50) | 导出格式类型 |
  | settings | TEXT | 导出设置（JSON格式） |
  | is_default | BOOLEAN | 是否为默认配置 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

## 5. 用户流程

### 5.1 进入作品导出

1. 用户在项目编辑界面点击“作品导出”按钮
2. 系统进入作品导出模块
3. 显示导出设置视图

### 5.2 导出作品

1. 用户在导出设置视图中选择导出格式（Word/PDF/Markdown/Text）
2. 用户选择导出的章节范围和内容
3. 用户设置导出选项，如字体、字号、行间距等
4. 用户点击“导出”按钮
5. 系统生成导出文件
6. 系统提示用户下载导出文件
7. 用户保存导出文件到本地

### 5.3 管理版本

1. 用户切换到版本管理视图
2. 用户查看现有版本列表
3. 用户点击“创建版本”按钮
4. 用户为版本设置名称和描述
5. 用户点击“保存”按钮，创建新版本
6. 用户选择两个版本，点击“对比”按钮，查看版本差异
7. 用户选择一个历史版本，点击“回滚”按钮，将作品恢复到该版本

### 5.4 投稿专用导出

1. 用户在导出设置视图中选择“投稿专用”选项
2. 用户选择投稿平台或格式模板
3. 系统自动调整导出设置以符合平台要求
4. 用户点击“导出”按钮
5. 系统生成符合平台要求的导出文件
6. 用户保存导出文件并提交到投稿平台

## 6. 功能价值

- **格式多样性**：支持多种导出格式，满足不同场景的需求
- **版本安全**：通过版本管理，确保作品的安全存储和历史记录
- **便捷分享**：方便用户分享作品给他人或投稿到平台
- **格式规范**：确保导出的文档格式规范、专业
- **时间节省**：自动化的导出和版本管理功能，节省用户时间

## 7. 未来扩展

- **云存储集成**：支持将版本备份到云存储服务，如Google Drive、Dropbox等
- **协作导出**：支持多用户协作时的导出和版本管理（未来版本）
- **批量导出**：支持批量导出多个章节或多个项目
- **导出模板**：提供更多自定义导出模板
- **自动发布**：支持直接从工具发布到小说平台（未来版本）

作品导出模块将成为用户完成创作后的重要工具，通过便捷的导出功能和可靠的版本管理，确保用户的创作成果得到妥善保存和有效利用。