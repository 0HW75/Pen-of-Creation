# 智能设定管理模块功能定义

## 1. 模块概述

智能设定管理模块是AI小说创作工具“创世之笔”的核心功能之一，为用户提供小说世界观、角色、物品、地点、势力等设定元素的智能管理工具。该模块旨在帮助用户构建完整、一致的小说设定体系，通过AI辅助和可视化工具，降低设定管理的复杂度，提高创作效率。

## 2. 核心功能

### 2.1 世界观生成

- **自动生成**：
  - 根据项目基础信息自动生成世界观大纲
  - 支持生成世界地图（概念）、核心规则、时间纪年、势力分布
  - 可针对特定部分深度细化，如地理环境、魔法体系等

- **迭代完善**：
  - 支持对生成的世界观进行迭代修改和完善
  - 提供世界观元素的添加、删除、修改功能
  - 支持世界观版本管理，可回溯历史版本

- **世界观结构**：
  - **世界地图**：概念性地图，标注重要地点和区域
  - **核心规则**：世界运行的基本法则，如魔法系统、科技水平等
  - **时间纪年**：世界的历史时间线，重要事件节点
  - **势力分布**：世界中的主要势力及其关系
  - **地理环境**：世界的自然环境，如气候、地形等
  - **种族设定**：世界中的智慧种族及其特点

### 2.2 角色创建

- **生成模式**：
  - **灵感生成**：快速生成角色基本框架，适合需要灵感启发的场景
  - **深度生成**：生成详细的角色设定，包括各种细节和背景

- **生成内容**：
  - **基本信息**：姓名、性别、年龄、种族、职业等
  - **外貌性格**：外貌特征、性格特点、行为习惯等
  - **背景故事**：成长经历、重要事件、人际关系等
  - **人物弧光**：角色的成长和变化历程
  - **动机目标**：角色的核心动机和追求目标
  - **秘密与谎言**：角色隐藏的秘密和谎言

- **角色管理**：
  - **角色卡视图**：以卡片形式展示角色关键信息，方便快速查看
  - **角色列表**：以列表形式展示所有角色，支持排序和筛选
  - **角色详情**：详细展示角色的所有设定信息
  - **角色关系**：自动生成和管理角色之间的关系

### 2.3 物品/地点/势力管理

- **物品管理**：
  - **基本信息**：名称、类型、描述、重要性等级
  - **属性设定**：物品的特殊属性、功能、来源
  - **关联管理**：关联到相关角色、地点、情节
  - **物品分类**：可按类型、重要性等进行分类管理

- **地点管理**：
  - **基本信息**：名称、类型、描述、重要性等级
  - **地理特征**：地点的自然环境、建筑风格等
  - **功能定位**：地点在故事中的作用和地位
  - **关联管理**：关联到相关角色、物品、情节

- **势力管理**：
  - **基本信息**：名称、类型、描述、重要性等级
  - **组织结构**：势力的内部结构、层级关系
  - **目标信仰**：势力的核心目标和信仰
  - **关联管理**：关联到相关角色、地点、物品

- **名词库**：
  - 自动建立和管理所有设定名词
  - 支持名词的搜索和快速引用
  - 维护名词的一致性，避免矛盾

### 2.4 关系图谱

- **可视化展示**：
  - 使用力导向图可视化展示角色-地点-势力-物品间的关系
  - 不同类型的节点使用不同的颜色和图标
  - 关系强度和类型通过连线的粗细和颜色区分

- **交互功能**：
  - 支持手动拖动调整节点位置
  - 点击节点可查看详细信息
  - 支持缩放、平移视图
  - 支持筛选特定类型的节点和关系

- **关系管理**：
  - 支持手动添加、删除、修改关系
  - 自动检测和提示潜在的关系冲突
  - 支持关系的层次化展示

## 3. 界面设计

### 3.1 整体布局

- **顶部导航栏**：
  - 模块标题：智能设定管理
  - 操作按钮：新建设定、导入设定、导出设定
  - 视图切换：列表视图/图谱视图

- **左侧边栏**：
  - 设定分类：世界观、角色、物品、地点、势力
  - 搜索框：快速搜索设定元素
  - 筛选条件：按类型、重要性等筛选

- **主内容区**：
  - 设定元素列表（列表视图）
  - 关系图谱（图谱视图）
  - 设定详情编辑表单

- **右侧边栏**：
  - 相关设定：显示与当前选中元素相关的其他设定
  - 智能建议：基于当前设定提供AI建议
  - 操作历史：显示最近的操作记录

### 3.2 核心组件

- **世界观编辑器**：
  - 树形结构展示世界观元素
  - 富文本编辑器用于详细描述
  - 地图绘制工具（简易）
  - 时间线编辑器

- **角色创建器**：
  - 多步骤表单，包含基本信息、外貌性格、背景故事等部分
  - 角色卡预览组件
  - 关系选择器，用于建立角色之间的关系

- **物品/地点/势力编辑器**：
  - 结构化表单，包含基本信息和详细属性
  - 关联选择器，用于关联到其他设定元素
  - 重要性等级滑块

- **关系图谱组件**：
  - ECharts力导向图
  - 节点和连线的自定义样式
  - 交互式操作工具栏

## 4. 技术实现

### 4.1 前端实现

- **技术栈**：React + Ant Design + ECharts + React-DnD
- **核心组件**：
  - Ant Design的Form、Tree、Card组件构建设定管理界面
  - ECharts力导向图实现关系图谱
  - React-DnD实现节点拖拽功能
  - 富文本编辑器用于详细描述编辑

- **交互逻辑**：
  - 实时保存设定变更
  - 动态更新关系图谱
  - 智能建议的实时生成和展示

### 4.2 后端实现

- **技术栈**：Python + Flask + SQLite + OpenAI API
- **核心功能**：
  - 设定数据的CRUD操作
  - 调用OpenAI API生成世界观和角色
  - 关系数据的处理和分析
  - 名词库的构建和管理

- **API设计**：
  - `POST /api/ai/generate_worldview`：生成世界观
  - `POST /api/ai/generate_character`：生成角色
  - `GET /api/projects/<id>/settings`：获取项目设定列表
  - `POST /api/settings`：创建新设定
  - `PUT /api/settings/<id>`：更新设定
  - `DELETE /api/settings/<id>`：删除设定
  - `GET /api/settings/<id>/relations`：获取设定关系

### 4.3 数据结构

- **世界观表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 世界观ID |
  | project_id | INTEGER | 项目ID |
  | name | VARCHAR(255) | 世界观名称 |
  | description | TEXT | 世界观描述 |
  | map_concept | TEXT | 世界地图（概念） |
  | core_rules | TEXT | 核心规则 |
  | timeline | TEXT | 时间纪年 |
  | faction_distribution | TEXT | 势力分布 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **角色表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 角色ID |
  | project_id | INTEGER | 项目ID |
  | name | VARCHAR(255) | 角色名 |
  | basic_info | TEXT | 基本信息 |
  | appearance | TEXT | 外貌描写 |
  | personality | TEXT | 性格描写 |
  | background | TEXT | 背景故事 |
  | character_arc | TEXT | 人物弧光 |
  | motivation | TEXT | 动机目标 |
  | secrets | TEXT | 秘密与谎言 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **物品表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 物品ID |
  | project_id | INTEGER | 项目ID |
  | name | VARCHAR(255) | 物品名 |
  | description | TEXT | 物品描述 |
  | type | VARCHAR(100) | 物品类型 |
  | importance | INTEGER | 重要性等级 |
  | properties | TEXT | 物品属性（JSON格式） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **地点表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 地点ID |
  | project_id | INTEGER | 项目ID |
  | name | VARCHAR(255) | 地点名 |
  | description | TEXT | 地点描述 |
  | type | VARCHAR(100) | 地点类型 |
  | importance | INTEGER | 重要性等级 |
  | features | TEXT | 地理特征（JSON格式） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **势力表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 势力ID |
  | project_id | INTEGER | 项目ID |
  | name | VARCHAR(255) | 势力名 |
  | description | TEXT | 势力描述 |
  | type | VARCHAR(100) | 势力类型 |
  | importance | INTEGER | 重要性等级 |
  | structure | TEXT | 组织结构（JSON格式） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **关系表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 关系ID |
  | project_id | INTEGER | 项目ID |
  | source_type | VARCHAR(50) | 源类型（角色/地点/物品/势力） |
  | source_id | INTEGER | 源ID |
  | target_type | VARCHAR(50) | 目标类型（角色/地点/物品/势力） |
  | target_id | INTEGER | 目标ID |
  | relationship_type | VARCHAR(100) | 关系类型 |
  | strength | INTEGER | 关系强度（1-10） |
  | description | TEXT | 关系描述 |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

## 5. 用户流程

### 5.1 进入设定管理

1. 用户在项目编辑界面点击“设定管理”按钮
2. 系统进入智能设定管理模块
3. 显示设定元素列表和关系图谱

### 5.2 生成世界观

1. 用户点击“生成世界观”按钮
2. 系统根据项目信息生成世界观大纲
3. 用户查看生成的世界观内容
4. 用户对世界观进行修改和完善
5. 用户保存世界观设定

### 5.3 创建角色

1. 用户点击“创建角色”按钮
2. 用户选择生成模式（灵感生成/深度生成）
3. 系统生成角色设定
4. 用户查看生成的角色内容
5. 用户对角色进行修改和完善
6. 用户保存角色设定

### 5.4 管理物品/地点/势力

1. 用户点击“新建”按钮，选择设定类型
2. 用户填写设定的基本信息和详细属性
3. 用户关联设定到其他相关元素
4. 用户保存设定

### 5.5 查看和编辑关系

1. 用户在关系图谱中查看设定元素之间的关系
2. 用户点击节点查看详细信息
3. 用户手动添加、删除、修改关系
4. 系统自动更新关系图谱

## 6. 功能价值

- **设定一致性**：通过集中管理设定元素，确保设定的一致性和连贯性
- **智能辅助**：利用AI生成设定内容，降低设定构建的难度
- **可视化管理**：通过关系图谱直观展示设定元素之间的关系
- **效率提升**：通过结构化表单和快速操作，提高设定管理效率
- **创作支持**：为后续的故事创作提供完整、详细的设定基础

## 7. 未来扩展

- **设定模板**：提供不同类型的设定模板，如“玄幻世界模板”、“科幻世界模板”等
- **设定导入/导出**：支持设定的导入和导出，方便在不同项目间共享
- **设定验证**：使用AI验证设定的合理性和一致性
- **设定可视化工具**：提供更丰富的设定可视化工具，如3D地图编辑器等
- **设定协作**：支持多用户协作编辑设定（未来版本）

智能设定管理模块将成为用户构建小说世界的核心工具，通过AI辅助和可视化技术，帮助用户创建完整、一致、丰富的小说设定体系，为故事创作提供坚实的基础。