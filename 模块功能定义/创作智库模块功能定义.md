# 创作智库模块功能定义

## 1. 模块概述

创作智库模块是AI小说创作工具“创世之笔”的核心功能之一，为用户提供创作资源的集中管理和智能检索工具。该模块旨在帮助用户积累和管理创作素材，通过全局数据库、创作笔记、回收站/废稿库和素材库，为创作提供丰富的资源支持和灵感来源。

## 2. 核心功能

### 2.1 全局数据库

- **数据存储**：
  - 记录所有设定元素（角色、地点、物品、势力等）
  - 记录所有情节关键点和发展脉络
  - 记录所有创作过程中的重要决策和修改
  - 支持数据的自动备份和恢复

- **智能索引**：
  - 自动为所有数据建立索引
  - 支持全文检索和关键词检索
  - 支持自然语言检索，如“查找与龙有关的设定”
  - 支持模糊搜索和相关搜索

- **知识图谱**：
  - 可视化展示设定元素和情节之间的关联
  - 以图形化方式展示概念间的关系
  - 支持图谱的缩放、平移和节点点击
  - 支持图谱的导出和分享

- **数据管理**：
  - 支持数据的分类和标签管理
  - 支持数据的批量操作（导入/导出/删除）
  - 支持数据的版本控制和历史记录
  - 支持数据的导入和导出（如JSON、CSV格式）

### 2.2 创作笔记

- **笔记类型**：
  - **全局笔记**：适用于整个项目的笔记
  - **章节笔记**：关联到特定章节的笔记
  - **设定笔记**：关联到特定设定的笔记
  - **灵感速记**：快速记录突发灵感

- **笔记功能**：
  - 支持富文本编辑，如字体、颜色、对齐等
  - 支持插入图片、链接等多媒体内容
  - 支持笔记的层级结构和目录
  - 支持笔记的搜索和筛选

- **关联管理**：
  - 支持将笔记关联到特定章节、设定或情节
  - 支持笔记之间的相互引用
  - 支持笔记与创作内容的双向链接
  - 支持笔记的标签和分类

- **灵感速记**：
  - 提供快速记录灵感的入口
  - 支持语音输入和文本输入
  - 支持灵感的分类和整理
  - 支持灵感的提醒和回顾

### 2.3 回收站/废稿库

- **内容管理**：
  - 暂存删除或未使用的设定/情节
  - 支持内容的预览和恢复
  - 支持内容的永久删除
  - 支持内容的分类和标签

- **废稿再利用**：
  - 支持将废稿重新引入到创作中
  - 提供废稿的搜索和筛选功能
  - 支持废稿的修改和调整
  - 支持废稿的版本管理

- **回收站功能**：
  - 支持内容的批量操作
  - 支持内容的自动清理（如超过一定时间的内容）
  - 支持回收站的容量管理
  - 支持回收站的导出和备份

### 2.4 素材库

- **素材类型**：
  - **描写素材**：优秀的环境、人物、动作、心理描写
  - **对话素材**：精彩的对话片段和台词
  - **情节素材**：引人入胜的情节设计和转折
  - **设定素材**：独特的世界观、角色、物品设定

- **素材管理**：
  - 支持素材的分类和标签管理
  - 支持素材的搜索和筛选
  - 支持素材的评分和收藏
  - 支持素材的批量操作

- **素材来源**：
  - 从网络导入素材
  - 从已有作品提取素材
  - 从AI生成的内容中保存素材
  - 手动添加和编辑素材

- **素材使用**：
  - 支持素材的预览和查看
  - 支持素材的复制和粘贴到创作中
  - 支持素材的修改和调整
  - 支持素材的引用和标注

## 3. 界面设计

### 3.1 整体布局

- **顶部导航栏**：
  - 模块标题：创作智库
  - 操作按钮：新建、导入、导出、设置
  - 视图切换：数据库视图/笔记视图/回收站视图/素材库视图

- **左侧边栏**：
  - 功能导航：全局数据库/创作笔记/回收站/素材库
  - 搜索框：快速搜索智库内容
  - 筛选条件：按类型、标签、时间等筛选

- **主内容区**：
  - 数据列表或图谱（数据库视图）
  - 笔记编辑器（笔记视图）
  - 废稿列表（回收站视图）
  - 素材卡片（素材库视图）

- **右侧边栏**：
  - 相关内容：显示与当前选中内容相关的其他内容
  - 智能推荐：基于当前内容提供AI推荐
  - 操作历史：显示最近的操作记录

### 3.2 核心组件

- **全局数据库组件**：
  - 数据列表组件，支持排序和筛选
  - 知识图谱可视化组件
  - 数据详情查看器
  - 数据编辑表单

- **创作笔记组件**：
  - 笔记树形导航
  - 富文本编辑器
  - 笔记预览组件
  - 灵感速记面板

- **回收站/废稿库组件**：
  - 废稿列表组件
  - 废稿预览组件
  - 废稿恢复操作面板
  - 回收站设置面板

- **素材库组件**：
  - 素材卡片网格
  - 素材详情查看器
  - 素材分类导航
  - 素材导入/导出面板

## 4. 技术实现

### 4.1 前端实现

- **技术栈**：React + Ant Design + ECharts + Monaco Editor
- **核心组件**：
  - ECharts力导向图实现知识图谱
  - Ant Design的List、Card、Tree组件构建界面
  - Monaco Editor实现富文本编辑器
  - Axios处理API请求

- **交互逻辑**：
  - 实时保存笔记和素材
  - 动态更新知识图谱
  - 智能搜索的异步处理
  - 拖拽功能支持内容排序

### 4.2 后端实现

- **技术栈**：Python + Flask + SQLite + NLP库
- **核心功能**：
  - 数据的CRUD操作和索引
  - 自然语言检索实现
  - 知识图谱数据生成
  - 素材管理和分析

- **API设计**：
  - `GET /api/knowledge_base`：获取全局数据库内容
  - `POST /api/knowledge_base`：添加新数据
  - `GET /api/notes`：获取创作笔记
  - `POST /api/notes`：创建新笔记
  - `GET /api/recycle_bin`：获取回收站内容
  - `POST /api/recycle_bin/recover`：恢复回收站内容
  - `GET /api/materials`：获取素材库内容
  - `POST /api/materials`：添加新素材

### 4.3 数据结构

- **全局数据表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 数据ID |
  | project_id | INTEGER | 项目ID |
  | type | VARCHAR(50) | 数据类型（设定/情节/笔记等） |
  | sub_type | VARCHAR(50) | 子类型（角色/地点/物品等） |
  | content | TEXT | 数据内容 |
  | tags | TEXT | 标签（JSON格式） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **笔记表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 笔记ID |
  | project_id | INTEGER | 项目ID |
  | chapter_id | INTEGER | 章节ID（可为空） |
  | setting_id | INTEGER | 设定ID（可为空） |
  | title | VARCHAR(255) | 笔记标题 |
  | content | TEXT | 笔记内容 |
  | type | VARCHAR(50) | 笔记类型（全局/章节/设定/灵感） |
  | tags | TEXT | 标签（JSON格式） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

- **回收站表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 回收站ID |
  | project_id | INTEGER | 项目ID |
  | original_id | INTEGER | 原始内容ID |
  | type | VARCHAR(50) | 内容类型（设定/章节/笔记等） |
  | content | TEXT | 内容 |
  | deleted_at | TIMESTAMP | 删除时间 |
  | status | VARCHAR(50) | 状态（可恢复/已恢复/已删除） |

- **素材表**：
  | 字段名 | 数据类型 | 描述 |
  |-------|---------|------|
  | id | INTEGER | 素材ID |
  | project_id | INTEGER | 项目ID |
  | type | VARCHAR(50) | 素材类型（描写/对话/情节/设定） |
  | title | VARCHAR(255) | 素材标题 |
  | content | TEXT | 素材内容 |
  | source | VARCHAR(255) | 素材来源 |
  | tags | TEXT | 标签（JSON格式） |
  | rating | INTEGER | 评分（1-5） |
  | created_at | TIMESTAMP | 创建时间 |
  | updated_at | TIMESTAMP | 更新时间 |

## 5. 用户流程

### 5.1 进入创作智库

1. 用户在项目编辑界面点击“创作智库”按钮
2. 系统进入创作智库模块
3. 显示全局数据库视图

### 5.2 使用全局数据库

1. 用户在全局数据库视图中浏览设定元素和情节
2. 用户使用搜索框查找特定内容
3. 用户点击知识图谱查看元素间的关联
4. 用户点击元素查看详细信息
5. 用户编辑或添加新的数据库内容

### 5.3 管理创作笔记

1. 用户在笔记视图中查看现有笔记
2. 用户点击“新建笔记”按钮创建新笔记
3. 用户选择笔记类型（全局/章节/设定/灵感）
4. 用户编辑笔记内容
5. 用户将笔记关联到特定章节或设定
6. 用户保存笔记

### 5.4 使用回收站/废稿库

1. 用户在回收站视图中查看已删除的内容
2. 用户点击内容预览其详细信息
3. 用户选择要恢复的内容，点击“恢复”按钮
4. 用户选择要永久删除的内容，点击“删除”按钮
5. 用户将废稿重新引入到创作中

### 5.5 管理素材库

1. 用户在素材库视图中浏览素材
2. 用户使用搜索框和筛选条件查找特定素材
3. 用户点击素材查看详细信息
4. 用户将素材复制到创作中
5. 用户点击“添加素材”按钮添加新素材
6. 用户为素材添加标签和评分

## 6. 功能价值

- **资源整合**：集中管理所有创作资源，提高资源利用效率
- **灵感管理**：通过灵感速记和素材库，捕捉和管理创作灵感
- **知识管理**：通过知识图谱和智能索引，构建作品的知识体系
- **效率提升**：通过快速搜索和素材复用，提高创作效率
- **质量保障**：通过参考优秀素材，提升作品质量
- **风险降低**：通过回收站功能，降低误删内容的风险

## 7. 未来扩展

- **素材推荐**：基于用户的创作风格和内容，智能推荐相关素材
- **素材社区**：支持用户分享和获取社区素材（未来版本）
- **AI素材生成**：使用AI生成符合特定需求的素材
- **多维度知识图谱**：支持更复杂、更丰富的知识图谱展示
- **跨项目资源共享**：支持在不同项目间共享和复用资源

创作智库模块将成为用户创作过程中的知识中心和资源库，通过智能管理和高效检索，帮助用户充分利用创作资源，激发创作灵感，提高创作效率和质量。