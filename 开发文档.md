# AI小说创作工具“创世之笔”开发文档

## 1. 项目概述

### 1.1 项目定位
专为独立创作者设计的智能小说创作伙伴，深度融合AI能力于创作全流程，提供非线性、深度智能辅助的创作环境。

### 1.2 核心功能
基于功能定义.txt文件，提取出以下核心功能模块：

1. **项目看板**：项目总览、信息管理、统计分析
2. **项目创建**：基础信息填写、智能开篇生成、目标设定、情绪板
3. **智能设定管理**：世界观生成、角色创建、物品/地点/势力管理、关系图谱
4. **故事蓝图**：大纲生成、卷纲分解、章纲细化
5. **智能写作工坊**：章节目录、沉浸式编辑器、侧边信息栏、智能写作辅助、AI写作模式、场景卡片
6. **实时一致性维护**：自动标注、实时检查、修改影响评估
7. **创作智库**：全局数据库、创作笔记、回收站/废稿库、素材库
8. **创作导航**：创作流程图、今日任务、灵感激发器
9. **作品分析**：健康度分析、统计数据、一键报告
10. **作品导出**：多格式导出、阶段性版本管理

### 1.3 技术栈
- **后端**：Python + Flask + SQLite
- **前端**：React + Ant Design + Monaco Editor + ECharts
- **AI集成**：OpenAI API

## 2. 技术架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         前端层                             │
│  React + Ant Design + Monaco Editor + ECharts              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │
│  │ 界面组件    │ │ 编辑器组件  │ │ 图表组件    │ │ 工具函数 │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │
└─────────────────┬──────────────┬──────────────┬────────────┘
                  │              │              │
┌─────────────────▼──────────────▼──────────────▼────────────┐
│                         API层                              │
│  Flask RESTful API                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │
│  │ 项目管理API │ │ 设定管理API │ │ 写作API     │ │ AI API │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │
└─────────────────┬──────────────┬──────────────┬────────────┘
                  │              │              │
┌─────────────────▼──────────────▼──────────────▼────────────┐
│                        服务层                              │
│  Python业务逻辑                                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │
│  │ 项目服务    │ │ 设定服务    │ │ 写作服务    │ │ AI服务 │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │
└─────────────────┬──────────────┬──────────────┬────────────┘
                  │              │              │
┌─────────────────▼──────────────▼──────────────▼────────────┐
│                        数据层                              │
│  SQLite数据库                                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │
│  │ 项目表      │ │ 设定表      │ │ 写作表      │ │ 素材表 │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技术选型理由

- **后端**：
  - **Flask**：轻量级Web框架，适合单用户应用，易于部署和维护
  - **SQLite**：嵌入式数据库，无需单独安装，适合单用户本地存储

- **前端**：
  - **React**：组件化开发，易于维护和扩展
  - **Ant Design**：丰富的UI组件库，提供良好的用户体验
  - **Monaco Editor**：微软开发的代码编辑器，支持语法高亮和自动补全
  - **ECharts**：强大的图表库，用于数据可视化和关系图谱

- **AI集成**：
  - **OpenAI API**：提供强大的自然语言处理能力，支持文本生成、改写等功能

## 3. 前端设计

### 3.1 整体布局
- **顶部导航栏**：项目切换、功能模块导航
- **左侧边栏**：当前项目的章节/设定导航
- **主内容区**：根据当前功能模块显示不同内容
- **右侧边栏**：上下文相关信息（如当前章节的角色/地点设定）
- **底部状态栏**：字数统计、写作时间、保存状态

### 3.2 核心组件

#### 3.2.1 项目看板组件
- **项目总览**：卡片式布局，支持看板/时间线/关系图三种视图切换
- **项目信息**：表单组件，支持多维度分类管理
- **统计分析**：图表组件，展示已写字数/角色数/场景数/完成度等数据

#### 3.2.2 项目创建组件
- **基础信息表单**：作品名、笔名、作品类型、目标读者、核心主题、一句话梗概
- **智能开篇生成器**：根据基础信息生成3-5个开篇选项
- **目标设定**：滑块组件，设定每日/总目标字数
- **情绪板**：图片上传组件，支持拖拽排序

#### 3.2.3 智能设定管理组件
- **世界观生成器**：表单组件，支持自动生成和手动编辑
- **角色创建器**：表单组件，支持灵感生成和深度生成两种模式
- **关系图谱**：ECharts力导向图，可视化展示角色-地点-势力-物品间关系

#### 3.2.4 故事蓝图组件
- **大纲生成器**：树形组件，展示完整大纲结构
- **卷纲分解器**：卡片组件，支持拖拽调整卷结构
- **章纲细化器**：表格组件，展示每章的场景/角色/事件信息

#### 3.2.5 智能写作工坊组件
- **章节目录**：树形组件，展示卷-章层级结构
- **沉浸式编辑器**：Monaco Editor，支持Markdown/富文本双模式
- **侧边信息栏**：卡片组件，显示当前章节相关设定
- **智能写作辅助**：按钮组，提供续写、润色、扩写、收束、对话优化、描写生成功能
- **AI写作模式**：标签切换，提供情节、人物、情绪、伏笔四种模式
- **场景卡片**：卡片组件，支持快速切换不同场景/视角

#### 3.2.6 实时一致性维护组件
- **自动标注**：高亮组件，自动识别文本中的设定名词
- **实时检查**：提示组件，显示角色一致性、时间线逻辑、设定冲突、伏笔追踪等问题
- **修改影响评估**：表格组件，列出受影响章节并提供修正建议

#### 3.2.7 创作智库组件
- **全局数据库**：搜索组件，支持自然语言检索
- **创作笔记**：编辑器组件，支持分章节/全局笔记
- **回收站/废稿库**：列表组件，展示删除或未使用的设定/情节
- **素材库**：分类组件，保存优秀描写/对话/情节片段

#### 3.2.8 创作导航组件
- **创作流程图**：进度条组件，可视化展示创作流程当前位置
- **今日任务**：列表组件，基于创作目标生成今日建议任务
- **灵感激发器**：卡片组件，提供情节转折建议/冲突点子/对话开场/场景灵感

#### 3.2.9 作品分析组件
- **健康度分析**：图表组件，展示节奏分析、角色分析、情绪曲线、伏笔分析
- **统计数据**：表格组件，展示详细写作统计、设定密度分析、作品完整度评估
- **一键报告**：导出组件，生成作品分析报告

#### 3.2.10 作品导出组件
- **多格式导出**：下拉菜单，支持Word/PDF/Markdown/纯文本格式
- **阶段性版本**：版本管理组件，支持创建版本节点、版本对比、回滚功能

### 3.3 交互逻辑
- **响应式设计**：适配不同屏幕尺寸
- **拖拽功能**：支持卡片、章节顺序的拖拽调整
- **实时保存**：自动保存用户输入，防止数据丢失
- **快捷键支持**：提供常用操作的快捷键
- **AI交互**：通过API调用OpenAI服务，实现智能写作辅助

## 4. 后端设计

### 4.1 目录结构

```
backend/
├── app/
│   ├── __init__.py
│   ├── api/
│   │   ├── __init__.py
│   │   ├── project.py
│   │   ├── setting.py
│   │   ├── writing.py
│   │   ├── ai.py
│   │   └── export.py
│   ├── services/
│   │   ├── __init__.py
│   │   ├── project_service.py
│   │   ├── setting_service.py
│   │   ├── writing_service.py
│   │   ├── ai_service.py
│   │   └── export_service.py
│   ├── models/
│   │   ├── __init__.py
│   │   ├── project.py
│   │   ├── setting.py
│   │   ├── writing.py
│   │   └── material.py
│   └── utils/
│       ├── __init__.py
│       ├── ai_utils.py
│       └── export_utils.py
├── config.py
├── run.py
└── requirements.txt
```

### 4.2 数据库设计

#### 4.2.1 项目表 (projects)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 项目ID |
| title | VARCHAR(255) | NOT NULL | 作品名 |
| pen_name | VARCHAR(255) | NOT NULL | 笔名 |
| genre | VARCHAR(100) | NOT NULL | 作品类型 |
| target_audience | VARCHAR(100) | NOT NULL | 目标读者 |
| core_theme | TEXT | NOT NULL | 核心主题 |
| synopsis | TEXT | NOT NULL | 一句话梗概 |
| daily_word_goal | INTEGER | DEFAULT 0 | 每日目标字数 |
| total_word_goal | INTEGER | DEFAULT 0 | 总目标字数 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.2 章节表 (chapters)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 章节ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| volume_id | INTEGER | REFERENCES volumes(id) | 卷ID |
| title | VARCHAR(255) | NOT NULL | 章节标题 |
| content | TEXT | DEFAULT '' | 章节内容 |
| status | VARCHAR(50) | DEFAULT '未写' | 状态(未写/写作中/已完成) |
| type | VARCHAR(50) | DEFAULT '普通' | 类型(冲突/日常/转折等) |
| word_count | INTEGER | DEFAULT 0 | 字数 |
| order_index | INTEGER | NOT NULL | 排序索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.3 角色表 (characters)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 角色ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| name | VARCHAR(255) | NOT NULL | 角色名 |
| basic_info | TEXT | DEFAULT '' | 基本信息 |
| appearance | TEXT | DEFAULT '' | 外貌描写 |
| personality | TEXT | DEFAULT '' | 性格描写 |
| background | TEXT | DEFAULT '' | 背景故事 |
| character_arc | TEXT | DEFAULT '' | 人物弧光 |
| motivation | TEXT | DEFAULT '' | 动机目标 |
| secrets | TEXT | DEFAULT '' | 秘密与谎言 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.4 地点表 (locations)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 地点ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| name | VARCHAR(255) | NOT NULL | 地点名 |
| description | TEXT | DEFAULT '' | 地点描述 |
| importance | INTEGER | DEFAULT 0 | 重要性等级 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.5 物品表 (items)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 物品ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| name | VARCHAR(255) | NOT NULL | 物品名 |
| description | TEXT | DEFAULT '' | 物品描述 |
| importance | INTEGER | DEFAULT 0 | 重要性等级 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.6 势力表 (factions)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 势力ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| name | VARCHAR(255) | NOT NULL | 势力名 |
| description | TEXT | DEFAULT '' | 势力描述 |
| importance | INTEGER | DEFAULT 0 | 重要性等级 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.7 关系表 (relationships)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 关系ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| source_type | VARCHAR(50) | NOT NULL | 源类型(角色/地点/物品/势力) |
| source_id | INTEGER | NOT NULL | 源ID |
| target_type | VARCHAR(50) | NOT NULL | 目标类型(角色/地点/物品/势力) |
| target_id | INTEGER | NOT NULL | 目标ID |
| relationship_type | VARCHAR(100) | NOT NULL | 关系类型 |
| description | TEXT | DEFAULT '' | 关系描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 4.2.8 素材表 (materials)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 素材ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| type | VARCHAR(50) | NOT NULL | 素材类型(描写/对话/情节) |
| content | TEXT | NOT NULL | 素材内容 |
| tags | TEXT | DEFAULT '' | 标签 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 4.2.9 笔记表 (notes)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 笔记ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| chapter_id | INTEGER | REFERENCES chapters(id) | 章节ID(可为空) |
| content | TEXT | NOT NULL | 笔记内容 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.10 版本表 (versions)
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 版本ID |
| project_id | INTEGER | REFERENCES projects(id) | 项目ID |
| version_name | VARCHAR(255) | NOT NULL | 版本名称 |
| description | TEXT | DEFAULT '' | 版本描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 4.3 API设计

#### 4.3.1 项目管理API
- `GET /api/projects`：获取项目列表
- `POST /api/projects`：创建新项目
- `GET /api/projects/<id>`：获取项目详情
- `PUT /api/projects/<id>`：更新项目信息
- `DELETE /api/projects/<id>`：删除项目

#### 4.3.2 章节管理API
- `GET /api/projects/<project_id>/chapters`：获取项目章节列表
- `POST /api/projects/<project_id>/chapters`：创建新章节
- `GET /api/chapters/<id>`：获取章节详情
- `PUT /api/chapters/<id>`：更新章节内容
- `DELETE /api/chapters/<id>`：删除章节

#### 4.3.3 设定管理API
- `GET /api/projects/<project_id>/characters`：获取项目角色列表
- `POST /api/projects/<project_id>/characters`：创建新角色
- `GET /api/characters/<id>`：获取角色详情
- `PUT /api/characters/<id>`：更新角色信息
- `DELETE /api/characters/<id>`：删除角色

- `GET /api/projects/<project_id>/locations`：获取项目地点列表
- `POST /api/projects/<project_id>/locations`：创建新地点
- `GET /api/locations/<id>`：获取地点详情
- `PUT /api/locations/<id>`：更新地点信息
- `DELETE /api/locations/<id>`：删除地点

- `GET /api/projects/<project_id>/items`：获取项目物品列表
- `POST /api/projects/<project_id>/items`：创建新物品
- `GET /api/items/<id>`：获取物品详情
- `PUT /api/items/<id>`：更新物品信息
- `DELETE /api/items/<id>`：删除物品

- `GET /api/projects/<project_id>/factions`：获取项目势力列表
- `POST /api/projects/<project_id>/factions`：创建新势力
- `GET /api/factions/<id>`：获取势力详情
- `PUT /api/factions/<id>`：更新势力信息
- `DELETE /api/factions/<id>`：删除势力

- `GET /api/projects/<project_id>/relationships`：获取项目关系列表
- `POST /api/projects/<project_id>/relationships`：创建新关系
- `GET /api/relationships/<id>`：获取关系详情
- `PUT /api/relationships/<id>`：更新关系信息
- `DELETE /api/relationships/<id>`：删除关系

#### 4.3.4 AI服务API
- `POST /api/ai/generate_opening`：生成智能开篇
- `POST /api/ai/generate_outline`：生成故事大纲
- `POST /api/ai/continue_writing`：AI续写
- `POST /api/ai/polish`：文本润色
- `POST /api/ai/expand`：文本扩写
- `POST /api/ai/condense`：文本收束
- `POST /api/ai/optimize_dialogue`：对话优化
- `POST /api/ai/generate_description`：生成描写
- `POST /api/ai/generate_worldview`：生成世界观
- `POST /api/ai/generate_character`：生成角色

#### 4.3.5 导出API
- `GET /api/export/project/<id>/word`：导出为Word格式
- `GET /api/export/project/<id>/pdf`：导出为PDF格式
- `GET /api/export/project/<id>/markdown`：导出为Markdown格式
- `GET /api/export/project/<id>/text`：导出为纯文本格式

## 5. 各功能模块的技术实现

### 5.1 项目看板
- **技术实现**：
  - 使用Ant Design的Card、Tabs、Statistic组件构建界面
  - 使用ECharts实现数据可视化图表
  - 后端通过SQL查询获取项目统计数据

### 5.2 项目创建
- **技术实现**：
  - 使用Ant Design的Form组件构建表单
  - 调用OpenAI API生成智能开篇
  - 使用React-DnD实现情绪板图片拖拽排序

### 5.3 智能设定管理
- **技术实现**：
  - 使用Ant Design的Form、Tree组件构建设定管理界面
  - 使用ECharts力导向图实现关系图谱
  - 调用OpenAI API生成世界观和角色

### 5.4 故事蓝图
- **技术实现**：
  - 使用Ant Design的Tree、Card组件构建大纲管理界面
  - 使用ECharts实现情绪/节奏曲线图
  - 调用OpenAI API生成故事大纲

### 5.5 智能写作工坊
- **技术实现**：
  - 使用Monaco Editor实现沉浸式编辑器
  - 使用Ant Design的Tabs、Collapse组件构建侧边信息栏
  - 调用OpenAI API实现智能写作辅助功能
  - 使用React-DnD实现场景卡片拖拽

### 5.6 实时一致性维护
- **技术实现**：
  - 使用正则表达式和NLP技术实现自动标注
  - 使用Ant Design的Alert、Badge组件显示实时检查结果
  - 后端实现修改影响评估算法

### 5.7 创作智库
- **技术实现**：
  - 使用Ant Design的Table、List组件构建数据库和素材库界面
  - 使用LocalStorage实现回收站功能
  - 使用SQLite全文搜索实现智能检索

### 5.8 创作导航
- **技术实现**：
  - 使用Ant Design的Steps组件构建创作流程图
  - 使用Ant Design的TaskList组件显示今日任务
  - 调用OpenAI API生成灵感建议

### 5.9 作品分析
- **技术实现**：
  - 使用ECharts实现健康度分析图表
  - 使用Ant Design的Statistic、Card组件显示统计数据
  - 后端实现作品分析算法

### 5.10 作品导出
- **技术实现**：
  - 使用Python-docx、weasyprint等库实现多格式导出
  - 使用SQLite事务实现版本管理功能
  - 使用Ant Design的Modal、Select组件构建导出界面

## 6. 技术实现要点

### 6.1 AI集成
- 使用OpenAI API实现智能写作辅助功能
- 实现API调用封装，处理请求参数和响应结果
- 实现错误处理和重试机制，确保AI服务的稳定性

### 6.2 数据管理
- 使用SQLite作为本地数据库，实现数据持久化
- 实现数据库迁移功能，支持版本升级
- 实现数据备份和恢复功能，确保数据安全

### 6.3 性能优化
- 使用React.memo、useMemo、useCallback等React优化技术
- 实现组件懒加载，减少初始加载时间
- 实现编辑器内容的防抖保存，减少API调用频率

### 6.4 离线功能
- 实现PWA(Progressive Web App)，支持离线访问
- 使用LocalStorage缓存常用数据
- 实现离线编辑和在线同步功能

### 6.5 安全性
- 实现API请求验证，防止非法访问
- 实现数据加密存储，保护用户隐私
- 实现输入验证，防止XSS攻击

## 7. 开发计划

### 7.1 开发阶段

1. **准备阶段** (1周)
   - 环境搭建
   - 技术栈选型
   - 数据库设计

2. **基础框架开发** (2周)
   - 后端API框架搭建
   - 前端项目初始化
   - 基础组件开发

3. **核心功能开发** (8周)
   - 项目管理模块
   - 设定管理模块
   - 写作编辑器模块
   - AI集成模块

4. **功能完善** (4周)
   - 一致性维护模块
   - 创作智库模块
   - 作品分析模块
   - 导出模块

5. **测试与优化** (2周)
   - 功能测试
   - 性能优化
   - 用户体验优化

### 7.2 技术依赖

#### 后端依赖
- Flask==2.0.1
- Flask-CORS==3.0.10
- SQLite3
- OpenAI==0.27.0
- Python-docx==0.8.11
- WeasyPrint==54.0

#### 前端依赖
- React==18.2.0
- Ant Design==5.0.0
- Monaco Editor==0.34.1
- ECharts==5.4.0
- React-DnD==16.0.1
- Axios==0.27.2

## 8. 总结

本开发文档基于功能定义.txt文件，详细描述了AI小说创作工具“创世之笔”的技术架构、前端设计、后端设计和各模块实现方案。采用Python+Flask+SQLite作为后端技术栈，React+Ant Design+Monaco Editor+ECharts作为前端技术栈，实现了一个功能完整、用户友好的智能小说创作工具。

该工具专为独立创作者设计，无需登录、协作等功能，专注于提供AI辅助的创作体验。通过深度融合AI能力于创作全流程，帮助作者从繁琐的设定管理和一致性维护中解放，真正专注于故事与表达的核心。