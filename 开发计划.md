# AI小说创作工具"创世之笔"开发计划

## 1. 项目概述

AI小说创作工具"创世之笔"是一款专为独立创作者设计的智能小说创作伙伴，深度融合AI能力于创作全流程，提供非线性、深度智能辅助的创作环境。本开发计划基于功能定义文档，旨在指导开发团队有序推进项目开发，确保核心功能优先实现，逐步完善和扩展功能。

## 2. 核心功能分析

### 2.1 核心功能

根据功能定义文档，识别出以下核心功能：

1. **项目基础管理**：
   - 项目创建、编辑、删除
   - 项目信息管理
   - 基础项目统计

2. **基本设定管理**：
   - 角色、地点、物品、势力的基础管理
   - 设定的添加、编辑、删除
   - 简单的设定关系管理

3. **基础编辑器**：
   - 章节管理
   - 基础文本编辑功能
   - 字数统计
   - 自动保存

4. **基础导出功能**：
   - 多格式导出（Word、PDF、Markdown、纯文本）
   - 基础版本管理

5. **基础数据存储**：
   - 本地数据存储
   - 基础数据备份

### 2.2 非核心功能

1. **AI辅助功能**：
   - 智能开篇生成
   - AI续写、润色
   - 智能设定生成

2. **高级数据可视化**：
   - 关系图谱
   - 情绪曲线
   - 节奏分析图表

3. **复杂分析功能**：
   - 作品健康度分析
   - 深度统计分析
   - 一键报告生成

4. **高级版本管理**：
   - 详细版本对比
   - 版本标签管理
   - 云存储备份

5. **扩展功能**：
   - 多端适配
   - 协作功能
   - 社区功能

## 3. 开发阶段划分

### 3.1 整体开发周期

预计总开发周期：20周

| 阶段 | 时间 | 主要目标 |
|------|------|----------|
| 第一阶段 | 8周 | 核心功能实现 |
| 第二阶段 | 4周 | 功能完善和调试 |
| 第三阶段 | 3周 | 优化和性能提升 |
| 第四阶段 | 5周 | 扩展功能和未来功能 |

### 3.2 第一阶段：核心功能实现（8周）

#### 3.2.1 第1-2周：项目初始化和基础架构

**任务1.1：项目初始化**
- 初始化前端React项目
- 初始化后端Flask项目
- 配置开发环境
- 搭建基础目录结构

**任务1.2：数据库设计和实现**
- 设计核心数据表结构
- 实现SQLite数据库初始化
- 创建基础数据模型

**任务1.3：API基础架构**
- 设计RESTful API接口
- 实现基础API路由
- 配置API文档

#### 3.2.2 第3-4周：项目管理和设定管理

**任务2.1：项目管理功能**
- 实现项目创建、编辑、删除
- 实现项目信息管理
- 实现基础项目列表展示

**任务2.2：设定管理功能**
- 实现角色、地点、物品、势力的CRUD操作
- 实现设定的基础展示
- 实现简单的设定关系管理

#### 3.2.3 第5-6周：编辑器核心功能

**任务3.1：章节管理**
- 实现章节的创建、编辑、删除
- 实现章节列表展示
- 实现章节排序

**任务3.2：基础编辑器**
- 集成Monaco Editor
- 实现基础文本编辑功能
- 实现字数统计
- 实现自动保存

#### 3.2.4 第7-8周：导出功能和数据存储

**任务4.1：导出功能**
- 实现多格式导出（Word、PDF、Markdown、纯文本）
- 实现基础导出设置

**任务4.2：数据存储**
- 实现本地数据存储
- 实现基础数据备份
- 实现简单的版本管理

### 3.3 第二阶段：功能完善和调试（4周）

#### 3.3.1 第9-10周：功能完善

**任务5.1：界面优化**
- 完善前端界面设计
- 优化用户交互体验
- 实现响应式布局

**任务5.2：功能扩展**
- 完善编辑器功能
- 增强设定管理功能
- 改进导出功能

#### 3.3.2 第11-12周：调试和测试

**任务6.1：bug修复**
- 修复前端bug
- 修复后端bug
- 修复数据存储问题

**任务6.2：测试**
- 进行功能测试
- 进行兼容性测试
- 进行性能测试

**任务6.3：用户反馈收集**
- 邀请内测用户
- 收集用户反馈
- 优先解决用户反馈的问题

### 3.4 第三阶段：优化和性能提升（3周）

#### 3.4.1 第13-14周：性能优化

**任务7.1：前端性能优化**
- 代码分割
- 组件懒加载
- 状态管理优化
- 网络请求优化

**任务7.2：后端性能优化**
- 数据库查询优化
- API响应优化
- 内存使用优化

#### 3.4.2 第15周：系统稳定性和用户体验

**任务8.1：系统稳定性提升**
- 错误处理优化
- 异常捕获和处理
- 系统日志完善

**任务8.2：用户体验优化**
- 界面响应速度优化
- 操作流程简化
- 交互反馈增强

**任务8.3：部署运维优化**
- 打包优化
- 部署脚本完善
- 监控系统搭建

### 3.5 第四阶段：扩展功能和未来功能（5周）

#### 3.5.1 第16-17周：AI辅助功能

**任务9.1：基础AI功能集成**
- 集成OpenAI API
- 实现智能开篇生成
- 实现基础AI续写功能

**任务9.2：智能设定生成**
- 实现智能世界观生成
- 实现智能角色生成

#### 3.5.2 第18-19周：高级功能

**任务10.1：数据可视化**
- 实现关系图谱
- 实现情绪曲线
- 实现节奏分析图表

**任务10.2：作品分析功能**
- 实现基础健康度分析
- 实现统计分析功能
- 实现一键报告生成

#### 3.5.3 第20周：未来功能准备

**任务11.1：多端适配准备**
- 响应式设计完善
- 移动端适配

**任务11.2：未来功能规划**
- 协作功能设计
- 社区功能设计
- 云存储集成设计

## 4. 技术栈和依赖

### 4.1 核心技术栈

- **后端**：Python + Flask + SQLite
- **前端**：React + Ant Design + Monaco Editor + ECharts
- **AI集成**：OpenAI API

### 4.2 主要依赖

#### 后端依赖
- Flask==2.0.1
- Flask-CORS==3.0.10
- SQLite3
- OpenAI==0.27.0
- Python-docx==0.8.11
- WeasyPrint==54.0

#### 前端依赖
- React==18.2.0
- Ant Design==5.0.0
- Monaco Editor==0.34.1
- ECharts==5.4.0
- React-DnD==16.0.1
- Axios==0.27.2
- FileSaver.js==2.0.5

## 5. 开发资源需求

### 5.1 人员需求

| 角色 | 数量 | 职责 |
|------|------|------|
| 后端开发者 | 1 | 负责后端API开发、数据库设计、AI集成 |
| 前端开发者 | 1 | 负责前端界面开发、用户交互、数据可视化 |
| 全栈开发者 | 1 | 负责项目整体架构、协调前后端开发、解决技术难题 |

### 5.2 硬件需求

- **开发环境**：
  - 处理器：至少i5或同等性能
  - 内存：至少8GB
  - 存储空间：至少50GB

- **测试环境**：
  - 多台不同配置的设备，确保兼容性

### 5.3 软件需求

- **开发工具**：
  - IDE：VS Code或PyCharm
  - 版本控制：Git
  - 包管理：npm、pip

- **测试工具**：
  - 浏览器：Chrome、Firefox、Edge
  - 测试框架：Jest、Pytest

## 6. 风险评估和应对策略

### 6.1 主要风险

1. **技术风险**：
   - AI API调用限制和成本
   - 数据存储和性能问题
   - 复杂数据可视化的实现难度

2. **时间风险**：
   - 功能开发周期延长
   - 测试和调试时间不足
   - 依赖库更新导致的兼容性问题

3. **质量风险**：
   - 核心功能稳定性不足
   - 用户体验不佳
   - 性能问题影响使用

### 6.2 应对策略

1. **技术风险应对**：
   - 优先实现核心功能，AI功能作为扩展
   - 优化数据库查询和存储策略
   - 采用渐进式开发，先实现基础可视化功能

2. **时间风险应对**：
   - 严格按照开发计划执行，定期检查进度
   - 预留缓冲时间，应对意外情况
   - 建立依赖库版本锁定机制，避免兼容性问题

3. **质量风险应对**：
   - 单元测试覆盖率不低于80%
   - 定期进行用户体验测试
   - 性能测试贯穿整个开发过程

## 7. 项目里程碑

| 里程碑 | 时间 | 完成标准 |
|--------|------|----------|
| 项目初始化完成 | 第2周末 | 前后端项目搭建完成，数据库设计完成 |
| 核心功能实现 | 第8周末 | 基础项目管理、设定管理、编辑器、导出功能实现 |
| 功能完善 | 第12周末 | 功能调试完成，用户反馈问题解决 |
| 性能优化 | 第15周末 | 系统性能优化完成，稳定性提升 |
| AI功能集成 | 第17周末 | 基础AI功能实现，智能辅助功能可用 |
| 高级功能实现 | 第19周末 | 数据可视化、作品分析功能实现 |
| 项目完成 | 第20周末 | 所有计划功能实现，系统稳定运行 |

## 8. 开发优先级建议

### 8.1 功能优先级

1. **最高优先级**：
   - 项目基础管理
   - 基础编辑器
   - 基础数据存储

2. **高优先级**：
   - 基本设定管理
   - 基础导出功能
   - 系统稳定性

3. **中优先级**：
   - AI辅助功能
   - 数据可视化
   - 作品分析功能

4. **低优先级**：
   - 多端适配
   - 协作功能
   - 社区功能

### 8.2 开发建议

1. **核心优先**：严格按照优先级实现功能，确保核心功能稳定可用
2. **增量开发**：采用增量开发方式，每完成一个功能模块就进行测试
3. **用户反馈**：在第二阶段积极收集用户反馈，及时调整开发方向
4. **性能关注**：从开发初期就关注系统性能，避免后期大规模重构
5. **文档同步**：开发过程中同步更新技术文档，确保项目可维护性

## 9. 测试策略

### 9.1 测试阶段

1. **单元测试**：
   - 针对每个功能模块进行单元测试
   - 确保代码质量和功能正确性

2. **集成测试**：
   - 测试模块间的集成
   - 确保系统整体功能正常

3. **系统测试**：
   - 测试完整系统功能
   - 确保系统稳定性和可靠性

4. **用户测试**：
   - 邀请目标用户进行测试
   - 收集用户反馈，优化用户体验

### 9.2 测试重点

1. **核心功能测试**：
   - 项目管理功能
   - 编辑器功能
   - 导出功能

2. **性能测试**：
   - 响应速度
   - 内存使用
   - 大数据量处理能力

3. **兼容性测试**：
   - 不同浏览器兼容性
   - 不同设备兼容性
   - 不同操作系统兼容性

## 10. 部署和发布策略

### 10.1 部署环境

- **开发环境**：本地开发机器
- **测试环境**：专用测试服务器
- **生产环境**：云服务器或本地部署

### 10.2 发布计划

1. **内部测试版**：第12周末发布，邀请内部测试人员测试
2. **公开测试版**：第15周末发布，向公众开放测试
3. **正式版1.0**：第20周末发布，核心功能完整，系统稳定

### 10.3 版本管理

- 采用语义化版本号：MAJOR.MINOR.PATCH
- 定期发布补丁版本，修复bug和优化性能
- 每3-6个月发布一个 minor 版本，添加新功能
- 每年发布一个 major 版本，进行重大更新

## 11. 总结

本开发计划基于功能定义文档，采用渐进式开发方法，优先实现核心功能，逐步完善和扩展功能。通过合理的时间规划和风险应对策略，确保项目能够按时、高质量地完成。

开发团队应严格按照本计划执行，定期检查进度，及时调整开发策略，确保项目顺利进行。同时，应保持与用户的沟通，收集反馈，不断优化产品，打造一款真正满足独立创作者需求的智能小说创作工具。

---

## 12. 第五阶段：AI智能设定生成（6周）【当前阶段】

### 12.1 阶段目标

实现AI智能设定生成功能，让AI能够根据用户需求自动生成设定数据库中各项数据条目，包括角色、地点、物品、势力、能量体系、文明文化等，大幅提升创作效率。

### 12.2 技术架构

基于现有的统一AI服务架构 (`AIService`) 进行扩展：

```
┌─────────────────────────────────────────────────────────────┐
│                    AI智能设定生成系统                        │
├─────────────────────────────────────────────────────────────┤
│  生成策略层                                                  │
│  ├─ 提示词模板管理 (PromptTemplateManager)                  │
│  ├─ 生成策略选择 (GenerationStrategySelector)               │
│  ├─ 上下文组装 (ContextAssembler)                           │
│  └─ 结果解析 (ResultParser)                                 │
├─────────────────────────────────────────────────────────────┤
│  实体生成器                                                  │
│  ├─ CharacterGenerator (角色生成器)                         │
│  ├─ LocationGenerator (地点生成器)                          │
│  ├─ ItemGenerator (物品生成器)                              │
│  ├─ FactionGenerator (势力生成器)                           │
│  ├─ EnergySystemGenerator (能量体系生成器)                  │
│  ├─ CivilizationGenerator (文明生成器)                      │
│  ├─ HistoricalEventGenerator (历史事件生成器)               │
│  └─ ... 其他实体生成器                                       │
├─────────────────────────────────────────────────────────────┤
│  基础服务层                                                  │
│  └─ AIService (现有统一AI服务接口)                          │
└─────────────────────────────────────────────────────────────┘
```

### 12.3 开发任务分解

#### 12.3.1 第1周：基础架构搭建

**任务12.1.1：提示词模板系统设计**
- 设计提示词模板数据结构
- 实现提示词模板管理器 (`PromptTemplateManager`)
- 创建基础提示词模板库（角色、地点、物品、势力）
- 支持模板变量替换和动态组装
- 实现模板版本管理

**任务12.1.2：生成策略系统**
- 设计生成策略选择器 (`GenerationStrategySelector`)
- 实现基于实体类型的策略路由
- 支持简单/详细/批量三种生成模式
- 实现生成参数配置（温度、token限制等）

**任务12.1.3：上下文组装器**
- 实现上下文组装器 (`ContextAssembler`)
- 支持关联实体信息注入（如生成角色时注入世界观信息）
- 实现用户输入与模板变量的映射
- 支持多轮对话上下文维护

#### 12.3.2 第2周：核心实体生成器实现

**任务12.2.1：角色生成器 (`CharacterGenerator`)**
- 实现基础角色信息生成（姓名、年龄、性别、种族等）
- 实现外貌特征生成（外貌描述、显著特征等）
- 实现性格与心理生成（性格、价值观、恐惧等）
- 实现背景故事生成（出身、成长经历、转折点等）
- 实现能力与装备生成（能力等级、特殊技能、装备等）
- 实现关系网络生成（家庭、朋友、仇敌等）
- 支持基于世界观的角色适配

**任务12.2.2：地点生成器 (`LocationGenerator`)**
- 实现基础地点信息生成（名称、类型、地理位置等）
- 实现环境特征生成（地形、气候、特殊环境等）
- 实现社会属性生成（人口、经济、文化等）
- 实现建筑与布局生成（整体布局、功能区、重要建筑等）
- 实现防御与资源生成（防御设施、守卫力量、资源等）
- 支持地点间的层级关系生成

**任务12.2.3：物品生成器 (`ItemGenerator`)**
- 实现基础物品信息生成（名称、类型、稀有度等）
- 实现物理属性生成（材质、外观、耐久度等）
- 实现功能效果生成（特殊效果、使用要求等）
- 实现来源与传承生成（制造者、历史、获取方式等）
- 支持基于世界观的物品适配（魔法物品、科技物品等）

#### 12.3.3 第3周：扩展实体生成器实现

**任务12.3.1：势力生成器 (`FactionGenerator`)**
- 实现基础势力信息生成（名称、类型、状态等）
- 实现理念与目标生成（核心思想、势力范围、目标等）
- 实现组织结构生成（领导体制、等级制度、部门设置等）
- 实现成员与资源生成（领导者、核心成员、人才储备等）
- 实现关系网络生成（盟友、敌对、从属关系等）

**任务12.3.2：能量体系生成器 (`EnergySystemGenerator`)**
- 实现能量类型定义生成（魔法、斗气、灵气等）
- 实现能量来源与获取生成
- 实现修炼体系生成（等级划分、晋升要求、特征等）
- 实现力量代价生成（使用限制、副作用、代价等）
- 实现通用技能生成

**任务12.3.3：文明文化生成器 (`CivilizationGenerator`)**
- 实现文明基础信息生成（名称、类型、发展阶段等）
- 实现社会结构生成（阶级体系、政治体制、法律体系等）
- 实现经济体系生成（货币、贸易、产业等）
- 实现文化习俗生成（节日、仪式、禁忌、价值观等）

#### 12.3.4 第4周：历史与地理生成器

**任务12.4.1：历史事件生成器 (`HistoricalEventGenerator`)**
- 实现历史纪元生成（时代划分、特征、技术等）
- 实现历史事件生成（战争、灾难、发现、革命等）
- 实现历史人物生成
- 支持事件间的因果关系和时间线

**任务12.4.2：地理区域生成器 (`RegionGenerator`)**
- 实现区域层级结构生成（大陆、国家、城市等）
- 实现地理特征生成（地形、气候、资源等）
- 实现区域关系生成（控制关系、贸易路线等）

**任务12.4.3：维度位面生成器 (`DimensionGenerator`)**
- 实现维度/位面信息生成
- 实现物理规则生成（时间流速、重力、魔法浓度等）
- 实现进入条件和限制生成

#### 12.3.5 第5周：前端集成与UI开发

**任务12.5.1：AI生成服务API**
- 创建统一的AI设定生成API (`/api/ai/generate-setting`)
- 实现各实体类型的生成端点
- 实现批量生成接口
- 实现生成进度反馈（流式输出）

**任务12.5.2：前端生成界面**
- 设计AI生成触发界面（各设定管理页面集成）
- 实现生成参数配置面板
- 实现生成结果预览和编辑界面
- 实现生成历史记录

**任务12.5.3：智能提示与引导**
- 实现生成提示词建议功能
- 实现基于已有设定的智能补全
- 实现生成示例展示

#### 12.3.6 第6周：测试与优化

**任务12.6.1：生成质量测试**
- 建立生成质量评估标准
- 进行多轮生成测试和调优
- 收集生成样本进行人工评估
- 优化提示词模板

**任务12.6.2：性能优化**
- 优化生成速度和响应时间
- 实现生成结果缓存
- 优化并发生成处理

**任务12.6.3：用户反馈集成**
- 实现生成结果反馈机制（点赞/点踩）
- 实现用户修正学习
- 完善错误处理和提示

### 12.4 数据库扩展

#### 12.4.1 新增表

**`ai_generation_templates`** - AI生成模板表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Integer | 主键 |
| entity_type | String(50) | 实体类型 |
| template_name | String(255) | 模板名称 |
| prompt_template | Text | 提示词模板 |
| variables | Text | 模板变量(JSON) |
| strategy | String(50) | 生成策略 |
| version | Integer | 模板版本 |
| is_default | Boolean | 是否默认 |
| created_at | DateTime | 创建时间 |

**`ai_generation_history`** - AI生成历史表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Integer | 主键 |
| project_id | Integer | 项目ID |
| user_id | Integer | 用户ID |
| entity_type | String(50) | 生成的实体类型 |
| prompt | Text | 用户输入提示 |
| generated_content | Text | 生成的内容 |
| parameters | Text | 生成参数(JSON) |
| provider | String(50) | AI提供商 |
| status | String(50) | 生成状态 |
| rating | Integer | 用户评分 |
| created_at | DateTime | 创建时间 |

**`ai_generation_feedback`** - AI生成反馈表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Integer | 主键 |
| history_id | Integer | 关联历史记录 |
| feedback_type | String(50) | 反馈类型 |
| content | Text | 反馈内容 |
| created_at | DateTime | 创建时间 |

### 12.5 API设计

#### 12.5.1 统一生成接口

```
POST /api/ai/generate-setting
```

请求参数：
```json
{
  "entity_type": "character",
  "prompt": "一个来自魔法学院的年轻天才",
  "world_id": 1,
  "strategy": "detailed",
  "parameters": {
    "temperature": 0.7,
    "max_tokens": 2000
  },
  "context": {
    "include_world_info": true,
    "include_related_entities": ["faction", "location"]
  }
}
```

响应：
```json
{
  "success": true,
  "data": {
    "name": "艾琳娜·星辉",
    "race": "人类",
    "age": 19,
    "description": "来自星辰魔法学院的年轻天才...",
    "appearance": "银白色的长发...",
    "personality": "聪明、好奇、有些固执...",
    "background": "出生于魔法世家...",
    "abilities": [...],
    "relationships": [...]
  },
  "generation_id": "gen_123456",
  "provider": "openai",
  "tokens_used": 1500
}
```

#### 12.5.2 批量生成接口

```
POST /api/ai/generate-setting/batch
```

#### 12.5.3 流式生成接口

```
POST /api/ai/generate-setting/stream
```

#### 12.5.4 模板管理接口

```
GET    /api/ai/generation-templates
POST   /api/ai/generation-templates
PUT    /api/ai/generation-templates/:id
DELETE /api/ai/generation-templates/:id
```

### 12.6 前端界面设计

#### 12.6.1 生成触发组件

在各设定管理页面添加AI生成按钮：
- 角色管理页面："AI生成角色"按钮
- 地点管理页面："AI生成地点"按钮
- 物品管理页面："AI生成物品"按钮
- 等等...

#### 12.6.2 生成对话框

包含以下元素：
- 提示词输入框（支持占位符提示）
- 生成策略选择（简单/详细/批量）
- 高级参数配置（温度、长度等）
- 关联上下文选择
- 生成按钮和进度显示

#### 12.6.3 结果预览面板

- 生成结果结构化展示
- 字段级编辑功能
- 重新生成选项
- 保存到数据库按钮

### 12.7 里程碑

| 里程碑 | 时间 | 完成标准 |
|--------|------|----------|
| 基础架构完成 | 第1周末 | 提示词模板系统和生成策略系统可用 |
| 核心生成器完成 | 第3周末 | 角色、地点、物品、势力生成器可用 |
| 扩展生成器完成 | 第4周末 | 能量、文明、历史、地理生成器可用 |
| 前端集成完成 | 第5周末 | 各设定管理页面集成AI生成功能 |
| 阶段完成 | 第6周末 | 所有生成器经过测试优化，质量达标 |

### 12.8 风险评估

| 风险 | 影响 | 应对策略 |
|------|------|----------|
| AI生成质量不稳定 | 高 | 建立多轮提示词优化机制，支持人工修正 |
| 生成速度慢 | 中 | 实现流式输出，优化提示词长度，使用缓存 |
| 生成结果不符合预期 | 中 | 提供详细的生成参数配置，支持生成前预览 |
| API调用成本高 | 低 | 实现生成结果缓存，批量生成优化 |

---

## 13. 项目维护说明

### 13.1 代码规范

- 遵循 `.trae/rules/project_rules.md` 中定义的项目开发规则
- 前后端字段命名保持一致，必要时进行字段映射转换
- 单个文件代码行数超过1200行时，考虑拆分为多个文件

### 13.2 数据库变更

- 所有数据库结构变更必须通过 Alembic 迁移脚本执行
- 修改字段时需同时更新前端表单和后端API
- 保留数据库备份以防数据丢失

### 13.3 临时文件管理

- 修复脚本等临时文件使用后应及时清理
- 数据库修复脚本应放入 `backend/migrations/` 目录
- 避免在项目根目录积累临时文件

### 13.4 AI生成系统维护

- 定期更新提示词模板以提升生成质量
- 监控生成API调用成本和性能
- 收集用户反馈持续优化生成策略
- 建立生成质量评估机制

---

**开发计划版本**：2.0
**制定日期**：2026-02-12
**适用范围**：AI小说创作工具"创世之笔"项目开发
**当前阶段**：第五阶段 - AI智能设定生成