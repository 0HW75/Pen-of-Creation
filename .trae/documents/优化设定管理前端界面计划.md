# 优化设定管理前端界面计划

## 一、现状分析

### 1.1 数据库字段覆盖情况

**已实现的模块：**
- ✅ 世界主表 (worlds) - 基础字段
- ✅ 维度/位面 (dimensions) - 基础字段
- ✅ 地理区域 (regions) - 基础字段
- ✅ 天体 (celestial_bodies) - 基础字段
- ✅ 自然法则 (natural_laws) - 基础字段
- ✅ 能量体系 (energy_systems) - 部分字段
- ✅ 能量形态 (energy_forms) - 基础字段
- ✅ 力量等级 (power_levels) - 基础字段
- ✅ 力量代价 (power_costs) - 基础字段
- ✅ 通用技能 (common_skills) - 基础字段
- ✅ 文明 (civilizations) - 部分字段
- ✅ 社会阶层 (social_classes) - 部分字段
- ✅ 文化习俗 (cultural_customs) - 部分字段
- ✅ 经济体系 (economic_systems) - 部分字段
- ✅ 政治体系 (political_systems) - 部分字段
- ✅ 历史纪元 (historical_eras) - 基础字段
- ✅ 历史事件 (historical_events) - 基础字段
- ✅ 历史人物 (historical_figures) - 基础字段

**缺失的模块：**
- ❌ 角色完整模块 (characters, character_attributes, character_backgrounds, character_personalities, character_abilities, character_equipments, character_relationships)
- ❌ 势力组织完整模块 (organizations, organization_structures, organization_members, organization_objectives, organization_relations, organization_resources)
- ❌ 地点完整模块 (locations, building_structures, location_features, location_inhabitants, special_locations)
- ❌ 物品完整模块 (items, equipment_attributes, consumable_effects, material_resources, item_recipes)
- ❌ 生物图鉴模块 (races, creature_species, creature_variants, creature_abilities)
- ❌ 关系网络模块 (timeline_events, causal_relationships, item_movements)
- ❌ 数据关联系统 (world_tags, entity_tags, cross_module_links, data_versions, world_attachments)

### 1.2 当前问题
1. 表单字段不完整，缺少数据库定义的大部分字段
2. 布局结构较为简单，没有按照功能模块分组
3. 缺少关联关系的管理界面
4. 没有实现标签页内的高级功能（如关系图谱、时间线可视化）

---

## 二、优化目标

参考 `数据库结构UI设计.md` 和 `设定数据库设定.md`，实现：
1. **完整的字段覆盖** - 包含数据库定义的所有字段
2. **合理的布局结构** - 按功能模块分组，使用标签页组织
3. **关联关系管理** - 支持实体间的关联操作
4. **可视化展示** - 统计卡片、关系图谱等

---

## 三、具体任务计划

### 阶段一：完善现有模块字段（高优先级）

#### 1.1 世界架构模块 (WorldArchitecture.jsx)
**当前问题：** 表单字段不完整

**需要添加的字段：**
- **维度管理：**
  - `parent_dimension_id` (父维度，支持嵌套)
  - `access_conditions` -> `entry_conditions` ✅ 已有
  - `physical_laws` -> `physical_properties` ✅ 已有
  - `time_flow_ratio` -> `time_flow` ✅ 已有
  - `energy_concentration` (能量浓度)
  - `stability_level` (稳定性)
  - `inhabitants` (主要栖居者)
  
- **区域管理：**
  - `area_size` (面积大小)
  - `terrain_features` (地形特征JSON)
  - `natural_resources` (自然资源列表)
  - `strategic_importance` (战略重要性)
  - `danger_level` (危险等级)
  - `map_coordinates` (地图坐标JSON)
  
- **天体管理：**
  - `parent_body_id` (绕哪个天体运行)
  - `size_category` (大小分类)
  - `orbital_period` (轨道周期)
  - `rotation_period` (自转周期)
  - `atmosphere_type` (大气类型)
  - `surface_conditions` (表面条件)
  - `inhabitable` (是否可居住)
  - `inhabitants` (栖居物种)
  
- **自然法则：**
  - `is_universal` (是否全局适用)
  - `affected_dimensions` (适用维度ID列表)
  - `affected_regions` (适用区域ID列表)
  - `enforcement_mechanism` (执行机制)
  - `discovery_history` (发现历史)

#### 1.2 能量体系模块 (EnergySystem.jsx)
**需要添加的字段：**
- **能量体系：**
  - `philosophical_alignment` (哲学倾向)
  - `natural_abundance` (自然丰度)
  - `tidal_cycle` (潮汐周期)
  - `conversion_efficiency` (转化效率)
  - `pollution_effect` (污染效应)
  - `storage_methods` (存储方式)
  - `detection_methods` (探测方式)
  - `fundamental_principles` (基本原理)
  
- **能量形态：**
  - `purification_method` (提纯方法)
  - `corruption_effects` (污染/腐化效果)
  - `sensory_perception` (感官感知)
  
- **力量等级：**
  - `level_framework` (等级框架JSON)
  - `breakthrough_conditions` (突破通用条件)
  - `bottleneck_description` (瓶颈描述)
  - `tribulation_system` (天劫/考验系统)
  - `regression_risk` (倒退风险)
  - `ultimate_form` (巅峰形态)
  - `lifespan_extension` (寿命延长)
  - `typical_combat_power` (典型战斗力)
  - `social_status` (社会地位)
  
- **通用技能：**
  - `energy_system_id` (所需能量体系)
  - `required_level` (最低等级要求)
  - `casting_components` (施法组件)
  - `effect_range` (影响范围)
  - `duration` (持续时间)
  - `cooldown` (冷却时间)
  - `cost_resource` (消耗资源)
  - `side_effects` (副作用)
  - `common_variations` (常见变体)

#### 1.3 社会体系模块 (SocietySystem.jsx)
**需要添加的字段：**
- **文明：**
  - `primary_region_id` (主要区域)
  - `population_scale` (人口规模)
  - `territory_size` (领土范围)
  - `technological_level` (科技水平)
  - `magical_level` (魔法水平)
  - `religious_beliefs` (宗教信仰)
  - `taboos` (禁忌)
  - `values` (价值观)
  
- **社会阶层：**
  - `civilization_id` (关联文明)
  - `typical_occupations` (典型职业)
  - `obligations` (义务)
  - `living_standards` (生活水平)
  - `education_access` (教育机会)
  - `social_mobility` (社会流动性)
  - `typical_power_level` (典型力量等级)
  
- **文化习俗：**
  - `civilization_id` (关联文明)
  - `frequency` (频率)
  - `participants` (参与者范围)
  - `required_actions` (必需行为)
  - `forbidden_actions` (禁忌行为)
  - `symbolic_meanings` (象征意义)
  - `variations` (地区变体)
  - `modern_adaptation` (现代适应)
  
- **经济体系：**
  - `civilization_id` (关联文明)
  - `currency_material` (货币材质)
  - `denomination_system` (面额体系)
  - `exchange_rates` (汇率体系JSON)
  - `major_industries` (主要产业JSON)
  - `trade_routes` (主要商路)
  - `trade_partners` (贸易伙伴)
  - `resource_dependencies` (资源依赖)
  - `wealth_distribution` (财富分布)
  - `taxation_system` (税收系统)
  - `banking_system` (银行系统)
  
- **政治体系：**
  - `civilization_id` (关联文明)
  - `succession_system` (继承制度)
  - `decision_process` (决策流程)
  - `administrative_divisions` (行政区划)
  - `legal_system` (法律体系)
  - `military_organization` (军事组织)
  - `diplomatic_style` (外交风格)
  - `internal_conflicts` (内部矛盾)
  - `external_threats` (外部威胁)

#### 1.4 历史脉络模块 (HistoryTimeline.jsx)
**需要添加的字段：**
- **历史纪元：**
  - `duration_description` (持续时间描述)
  - `main_characteristics` (时代特征)
  - `key_technologies` (关键技术)
  - `dominant_civilizations` (主导文明)
  - `ending_cause` (结束原因)
  - `legacy_impact` (遗留影响)
  
- **历史事件：**
  - `era_id` (关联纪元)
  - `location_ids` (地点ID列表JSON)
  - `primary_causes` (主要原因)
  - `key_participants` (主要参与者)
  - `event_sequence` (事件过程)
  - `immediate_outcomes` (直接结果)
  - `long_term_consequences` (长期影响)
  - `historical_significance` (历史意义)
  - `conflicting_accounts` (矛盾记载)
  
- **历史人物：**
  - `civilization_id` (关联文明)
  - `character_id` (关联角色)
  - `birth_place_id` (出生地)
  - `death_place_id` (死亡地)
  - `social_class` (社会阶级)
  - `key_achievements` (主要成就)
  - `controversies` (争议)
  - `historical_legacy` (历史遗产)

---

### 阶段二：重构表单布局（高优先级）

#### 2.1 统一表单布局规范
参考UI设计文档，每个模块的表单应该：
- 使用分组卡片组织相关字段
- 基础信息放在第一组
- 详细描述使用富文本或文本域
- JSON字段提供结构化输入或文本输入
- 关联字段使用选择器

#### 2.2 表单分组设计
每个创建/编辑模态框应该包含以下分组：
```
┌─────────────────────────────────────────┐
│ 基本信息                                 │
│  - 名称、类型、状态等基础字段            │
├─────────────────────────────────────────┤
│ 详细描述                                 │
│  - 描述、特征、规则等长文本字段          │
├─────────────────────────────────────────┤
│ 关联关系                                 │
│  - 父级、所属、关联实体等外键字段        │
├─────────────────────────────────────────┤
│ 高级属性                                 │
│  - JSON字段、数值属性等特殊字段          │
└─────────────────────────────────────────┘
```

---

### 阶段三：新增缺失模块（中优先级）

#### 3.1 角色管理模块
创建 `CharacterManagement.jsx` 组件，包含：
- 角色主表管理
- 角色属性管理（弹窗或抽屉形式）
- 角色背景故事管理
- 角色性格管理
- 角色能力管理
- 角色装备管理
- 角色关系管理

#### 3.2 势力组织模块
创建 `FactionManagement.jsx` 组件，包含：
- 组织主表管理
- 组织架构管理（树形结构）
- 组织成员管理
- 组织目标管理
- 组织关系管理
- 组织资源管理

#### 3.3 地点场景模块
创建 `LocationManagement.jsx` 组件，包含：
- 地点主表管理
- 建筑结构管理
- 区域特征管理
- 地点居民管理
- 特殊地点管理

#### 3.4 物品资源模块
创建 `ItemManagement.jsx` 组件，包含：
- 物品主表管理
- 装备属性管理
- 消耗品效果管理
- 材料资源管理
- 物品制作配方管理

---

### 阶段四：增强交互功能（中优先级）

#### 4.1 关联选择器组件
- 创建通用的关联实体选择器
- 支持搜索、分页、多选
- 显示关联实体的关键信息

#### 4.2 JSON字段编辑器
- 为JSON字段提供结构化编辑界面
- 支持键值对添加、删除、编辑
- 提供导入/导出JSON功能

#### 4.3 富文本编辑器
- 为长文本描述字段集成富文本编辑器
- 支持基本的格式化功能

---

### 阶段五：可视化增强（低优先级）

#### 5.1 统计面板优化
- 添加趋势图表
- 添加分布图表
- 添加关联统计

#### 5.2 关系图谱
- 集成关系图谱可视化
- 支持节点拖拽、缩放
- 支持点击查看详情

---

## 四、实施顺序建议

### 第一轮：基础完善
1. 完善世界架构模块字段
2. 完善能量体系模块字段
3. 完善社会体系模块字段
4. 完善历史脉络模块字段

### 第二轮：布局重构
5. 统一表单布局规范
6. 重构所有模态框表单

### 第三轮：功能扩展
7. 实现角色管理模块
8. 实现势力组织模块
9. 实现地点场景模块
10. 实现物品资源模块

### 第四轮：体验优化
11. 添加关联选择器组件
12. 添加JSON字段编辑器
13. 添加富文本编辑器
14. 优化统计面板

---

## 五、预期成果

完成后，设定管理界面将：
1. 覆盖数据库定义的所有字段
2. 提供清晰的功能分组和导航
3. 支持完整的实体关联管理
4. 提供良好的用户体验和可视化效果

请确认这个计划后，我将开始实施具体的代码修改。